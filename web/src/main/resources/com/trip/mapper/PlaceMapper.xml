<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.trip.web.mapper.PlaceMapper">

    <resultMap id="BaseResultMap" type="com.trip.model.entity.Place">
        <id property="id" column="id" />
        <result property="name" column="name" />
        <result property="typeId" column="type_id" />
        <result property="uid" column="uid" />
        <result property="lat" column="lat" />
        <result property="lng" column="lng" />
        <result property="address" column="address" />
        <result property="telephone" column="telephone" />
        <result property="createTime" column="create_time" />
        <result property="updateTime" column="update_time" />
        <result property="isDeleted" column="is_deleted" />
    </resultMap>

    <sql id="Base_Column_List">
        id, name, type_id, uid, lat, lng, address, telephone,
        create_time, update_time, is_deleted
    </sql>

    <resultMap id="PlaceDayTypeMap" type="com.trip.model.vo.PlaceDayTypeVO">
        <result property="day" column="day"/>

        <collection property="places" ofType="com.trip.model.vo.PlaceDayTypeVO$PlaceType">
            <result property="placeId" column="placeId"/>
            <result property="name"    column="name"/>
            <result property="lat"     column="lat"/>
            <result property="lng"     column="lng"/>
            <result property="address" column="address"/>
            <result property="type"    column="type"/>
        </collection>
    </resultMap>
    <select id="getPlaceDayTypeByTripId" resultMap="PlaceDayTypeMap">
        select trip_place.day as day,
               place.id            as placeId,
               place.name          as name,
               place.lat           as lat,
               place.lng           as lng,
               place.address       as address,
               place_type.code     as type
        from trip_place
            join place
        on trip_place.place_id = place.id
            and trip_place.trip_id = #{tripId}
            join place_type on place.type_id = place_type.id
        order by trip_place.day asc
    </select>

</mapper>
